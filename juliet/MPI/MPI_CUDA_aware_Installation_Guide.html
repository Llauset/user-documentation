<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-juliet/MPI/MPI_CUDA_aware_Installation_Guide">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Building a CUDA-aware Open MPI  library on an Infiniband cluster | MesoNET User Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://www.mesonet.fr/documentation/user-documentation/img/mesonet-logo.png"><meta data-rh="true" name="twitter:image" content="https://www.mesonet.fr/documentation/user-documentation/img/mesonet-logo.png"><meta data-rh="true" property="og:url" content="https://www.mesonet.fr/documentation/user-documentation/juliet/MPI/MPI_CUDA_aware_Installation_Guide"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Building a CUDA-aware Open MPI  library on an Infiniband cluster | MesoNET User Documentation"><meta data-rh="true" name="description" content="Historically, on Infiniband clusters, Open MPI was built with the openib BTL support, enabled when Open MPI is configured --with-verbs. The openib BTL became deprecated in favor of the Unified Communication X (UCX) PML. Hence, the current documentation shows some guidelines on how to install a CUDA-Aware Open MPI library with UCX. Note that all the examples used in this document were run on juliet supercomputer."><meta data-rh="true" property="og:description" content="Historically, on Infiniband clusters, Open MPI was built with the openib BTL support, enabled when Open MPI is configured --with-verbs. The openib BTL became deprecated in favor of the Unified Communication X (UCX) PML. Hence, the current documentation shows some guidelines on how to install a CUDA-Aware Open MPI library with UCX. Note that all the examples used in this document were run on juliet supercomputer."><link data-rh="true" rel="icon" href="/documentation/user-documentation/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://www.mesonet.fr/documentation/user-documentation/juliet/MPI/MPI_CUDA_aware_Installation_Guide"><link data-rh="true" rel="alternate" href="https://www.mesonet.fr/documentation/user-documentation/juliet/MPI/MPI_CUDA_aware_Installation_Guide" hreflang="en"><link data-rh="true" rel="alternate" href="https://www.mesonet.fr/documentation/user-documentation/juliet/MPI/MPI_CUDA_aware_Installation_Guide" hreflang="x-default"><link rel="stylesheet" href="/documentation/user-documentation/assets/css/styles.b41ede53.css">
<link rel="preload" href="/documentation/user-documentation/assets/js/runtime~main.a7b5a4c7.js" as="script">
<link rel="preload" href="/documentation/user-documentation/assets/js/main.7dfe1b35.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/documentation/user-documentation/"><div class="navbar__logo"><img src="/documentation/user-documentation/img/mesonet-logo.png" alt="MesoNET Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/documentation/user-documentation/img/mesonet-logo.png" alt="MesoNET Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">MesoNET User Documentation</b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/MesoNET/user-documentation" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/documentation/user-documentation/connectToMesonet">Request a mesonet account</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/documentation/user-documentation/Doc_Utilisateur_Slurm">Documentation Utilisateur pour Slurm</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/documentation/user-documentation/">MesoNET user documentation</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/documentation/user-documentation/juliet/Apptainer/Building_NGC_Containers">juliet</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/documentation/user-documentation/juliet/Apptainer/Building_NGC_Containers">Apptainer</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/documentation/user-documentation/juliet/MPI/MPI_CUDA_aware_Installation_Guide">MPI</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/documentation/user-documentation/juliet/MPI/MPI_CUDA_aware_Installation_Guide">Building a CUDA-aware Open MPI  library on an Infiniband cluster</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/user-documentation/juliet/adresses_vm">adresses_vm</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/documentation/user-documentation/juliet/benchmarks/Nvidia_HPC_Benchmarks">benchmarks</a></div></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/documentation/user-documentation/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">juliet</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">MPI</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Building a CUDA-aware Open MPI  library on an Infiniband cluster</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Building a CUDA-aware Open MPI  library on an Infiniband cluster</h1><p>Historically, on Infiniband clusters, Open MPI was built with the openib BTL support, enabled when Open MPI is configured --with-verbs. The openib BTL became deprecated in favor of the Unified Communication X (UCX) PML. Hence, the current documentation shows some guidelines on how to install a CUDA-Aware Open MPI library with UCX. Note that all the examples used in this document were run on juliet supercomputer. </p><p>The building process includes two main steps:</p><ol><li>Building UCX with GPU support (+ some GPU-specific module kernels)</li><li>Building OpenMPI with previously configured UCX</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="setting-up-and-building-ucx-with-gpu-support">Setting up and building UCX with GPU support<a href="#setting-up-and-building-ucx-with-gpu-support" class="hash-link" aria-label="Direct link to Setting up and building UCX with GPU support" title="Direct link to Setting up and building UCX with GPU support">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="gpu-communication-performance">GPU communication performance<a href="#gpu-communication-performance" class="hash-link" aria-label="Direct link to GPU communication performance" title="Direct link to GPU communication performance">​</a></h3><p>Before building UCX, we might need to set up the GPUDirect RDMA technology, in order to improve the GPU communication performance. Prior to CUDA 11.4, GPUDirect RDMA technology was handled by the
<code>nv_peer_memory</code> kernel developed by Mellanox. Starting with CUDA 11.4 there is a new kernel module called <code>nvidia-peermem</code> implemented by Nvidia. To note that <code>nv_peer_memory</code> became deprecated and should be replaced by <code>nvidia-peermem</code>. Please visit the <a href="https://docs.nvidia.com/cuda/gpudirect-rdma/" target="_blank" rel="noopener noreferrer">Nvidia website</a> for more details.</p><p>Additionally, to optimize the intra-node GPU communication latency, UCX should be build with the <code>gdrcopy</code> support. The last one is a library based on the GPUDirect RDMA features. A data transfer performed with <code>gdrcopy</code> is driven by the CPU, and is meant to reduce the communication latency. This library is composed of a kernel module called <code>gdrdrv</code> and a API called <code>gdrapi</code>.</p><p>Hence, before building UCX please make sure that both <code>nvidia-peermem</code> and <code>gdrdrv</code> kernel modules are installed and loaded. </p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ lsmod | grep gdrdrv</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ lsmod | grep nvidia_peermem</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If the kernel modules are not loaded please refer to the following resources for <a href="https://github.com/NVIDIA/gdrcopy" target="_blank" rel="noopener noreferrer">installing gdrcopy</a> and/or for <a href="https://docs.nvidia.com/cuda/gpudirect-rdma/" target="_blank" rel="noopener noreferrer">loading nvidia-peermem</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="building-ucx">Building UCX<a href="#building-ucx" class="hash-link" aria-label="Direct link to Building UCX" title="Direct link to Building UCX">​</a></h3><p>Building UCX is typically a combination of running &quot;configure&quot; and &quot;make&quot;. For GPU support we need to specify the cuda and gdrcopy install directories via the <code>--with-cuda</code> and <code>--with-gdrcopy</code> options of &quot;configure&quot;. Below are the steps required to build and install UCX on juliet supercomputer. The latest release UCX tarball can be downloaded from the <a href="https://github.com/openucx/ucx/releases" target="_blank" rel="noopener noreferrer">UCX repository</a>. </p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ ./configure --prefix=&lt;prefix_path&gt; --with-cuda=/apps/spack/spack-softwares/linux-rocky9-zen3/gcc-13.1.0/cuda-12.1.1-hhxtp4y7d55t27jbbxwpjxc4t24tgi3h --with-gdrcopy=/apps/manual_install/gdrcopy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ make -j8 install</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Once the installation is completed, the information about the current UCX installation instance can be retrieved via the <code>ucx_info</code> command. For example, it is possible to check the UCX GPU support via the following command:</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ ucx_info -d | grep cuda</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>To obtain more information it is also possible to change the UCX log level: </p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ env UCX_LOG_LEVEL=debug ucx_info -d | grep -i cuda</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="setting-up-and-building-openmpi">Setting up and building OpenMPI<a href="#setting-up-and-building-openmpi" class="hash-link" aria-label="Direct link to Setting up and building OpenMPI" title="Direct link to Setting up and building OpenMPI">​</a></h2><p> Below are the commands for building a CUDA-Aware OpenMPI library with Slurm support on juliet supercomputer. We need to specify the path to the UCX installation directory via the <code>--with-ucx</code> option and the path to cuda via <code>--with-cuda</code>. Additionally, we need to set the <code>--with-pmi</code> option for supporting slurm (i.e. running MPI application with srun). We also disable the btl openib via <code>--without-verbs</code> option. </p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ ./configure --prefix=&lt;prefix_path&gt; --with-ucx=&lt;path_to_ucx_install&gt; --with-cuda=/apps/spack/spack-softwares/linux-rocky9-zen3/gcc-13.1.0/cuda-12.1.1-hhxtp4y7d55t27jbbxwpjxc4t24tgi3h --with-pmi --without-verbs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">make -j8 install</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Check that OpenMPI has been built with CUDA-aware support:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ ompi_info --parsable --all | grep mpi_built_with_cuda_support:value</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>Recent OpenMPI versions contain a BTL component called <code>uct</code>, which might cause data corruption when building MPI with UCX. If needed, you can disable <code>uct</code> via the <code>--enable-mca-no-build=btl-uct</code> configuration option. More information about building MPI with UCX can be found <a href="https://openucx.readthedocs.io/en/master/running.html" target="_blank" rel="noopener noreferrer">here</a>.</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="openmpi-performance-tests">OpenMPI performance tests<a href="#openmpi-performance-tests" class="hash-link" aria-label="Direct link to OpenMPI performance tests" title="Direct link to OpenMPI performance tests">​</a></h2><p>For testing the performance of a CUDA-Aware OpenMPI installation instance, one can use the well-known OSU benchmarks. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="building-osu-micro-benchmarks">Building OSU Micro-Benchmarks<a href="#building-osu-micro-benchmarks" class="hash-link" aria-label="Direct link to Building OSU Micro-Benchmarks" title="Direct link to Building OSU Micro-Benchmarks">​</a></h3><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ wget https://mvapich.cse.ohio-state.edu/download/mvapich/osu-micro-benchmarks-7.2.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ tar xfp osu-micro-benchmarks-7.2.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ cd osu-micro-benchmarks-7.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ ./configure CC=mpicc CXX=mpicxx --prefix=&lt;prefix&gt; --enable-cuda</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ make install</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="running-osu-micro-benchmarks">Running OSU Micro-Benchmarks<a href="#running-osu-micro-benchmarks" class="hash-link" aria-label="Direct link to Running OSU Micro-Benchmarks" title="Direct link to Running OSU Micro-Benchmarks">​</a></h3><p>By default, UCX tries to use all available devices on the machine and selects the best ones based on performance characteristics. One can also use manual tunning in order to force the use of certain devices or technologies.</p><p>For example, we can enable or disable the use of GPUDirect RDMA optimization (available through the <code>nvidia-peermem</code> kernel) and enable or disable the use of gdrcopy (i.e. use of the <code>gdrdrv</code> kernel). Below are a few examples.</p><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Performance graph</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">GPUDirect RDMA and gdrcopy</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">GPUDirect RDMA only</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">gdrcopy only</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">no GDR optimization</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="614.4" height="460.8" viewBox="0 0 460.8 345.6" xmlns="http://www.w3.org/2000/svg"><defs><style>*{stroke-linejoin:round;stroke-linecap:butt}</style></defs><g id="figure_1"><path d="M0 345.6h460.8V0H0z" style="fill:#fff" id="patch_1"></path><g id="axes_1"><path d="M50.87 303.64H450V26.88H50.87z" style="fill:#fff" id="patch_2"></path><g id="matplotlib.axis_1"><g id="xtick_1"><g id="line2d_1"><defs><path id="me048898c50" d="M0 0v3.5" style="stroke:#000;stroke-width:0.8"></path></defs><use xlink:href="#me048898c50" x="68.99" y="303.64" style="stroke:#000;stroke-width:0.8"></use></g><g transform="matrix(.1 0 0 -.1 65.809 318.238)" id="text_1"><defs><path id="DejaVuSans-30" d="M2034 4250q-487 0-733-480-245-479-245-1442 0-959 245-1439 246-480 733-480 491 0 736 480 246 480 246 1439 0 963-246 1442-245 480-736 480zm0 500q785 0 1199-621 414-620 414-1801 0-1178-414-1799Q2819-91 2034-91q-784 0-1198 620-414 621-414 1799 0 1181 414 1801 414 621 1198 621z" transform="scale(.01563)"></path></defs><use xlink:href="#DejaVuSans-30"></use></g></g><g id="xtick_2"><use xlink:href="#me048898c50" x="124.359" y="303.64" style="stroke:#000;stroke-width:0.8" id="line2d_2"></use><g transform="matrix(.1 0 0 -.1 111.634 318.238)" id="text_2"><defs><path id="DejaVuSans-32" d="M1228 531h2203V0H469v531q359 372 979 998 621 627 780 809 303 340 423 576 121 236 121 464 0 372-261 606-261 235-680 235-297 0-627-103-329-103-704-313v638q381 153 712 231 332 78 607 78 725 0 1156-363 431-362 431-968 0-288-108-546-107-257-392-607-78-91-497-524-418-433-1181-1211z" transform="scale(.01563)"></path><path id="DejaVuSans-35" d="M691 4666h2478v-532H1269V2991q137 47 274 70 138 23 276 23 781 0 1237-428 457-428 457-1159 0-753-469-1171Q2575-91 1722-91q-294 0-599 50Q819 9 494 109v635q281-153 581-228t634-75q541 0 856 284 316 284 316 772 0 487-316 771-315 285-856 285-253 0-505-56-251-56-513-175v2344z" transform="scale(.01563)"></path></defs><use xlink:href="#DejaVuSans-32"></use><use xlink:href="#DejaVuSans-35" x="63.623"></use><use xlink:href="#DejaVuSans-30" x="127.246"></use><use xlink:href="#DejaVuSans-30" x="190.869"></use></g></g><g id="xtick_3"><use xlink:href="#me048898c50" x="179.729" y="303.64" style="stroke:#000;stroke-width:0.8" id="line2d_3"></use><g transform="matrix(.1 0 0 -.1 167.004 318.238)" id="text_3"><use xlink:href="#DejaVuSans-35"></use><use xlink:href="#DejaVuSans-30" x="63.623"></use><use xlink:href="#DejaVuSans-30" x="127.246"></use><use xlink:href="#DejaVuSans-30" x="190.869"></use></g></g><g id="xtick_4"><use xlink:href="#me048898c50" x="235.098" y="303.64" style="stroke:#000;stroke-width:0.8" id="line2d_4"></use><g transform="matrix(.1 0 0 -.1 222.373 318.238)" id="text_4"><defs><path id="DejaVuSans-37" d="M525 4666h3000v-269L1831 0h-659l1594 4134H525v532z" transform="scale(.01563)"></path></defs><use xlink:href="#DejaVuSans-37"></use><use xlink:href="#DejaVuSans-35" x="63.623"></use><use xlink:href="#DejaVuSans-30" x="127.246"></use><use xlink:href="#DejaVuSans-30" x="190.869"></use></g></g><g id="xtick_5"><use xlink:href="#me048898c50" x="290.467" y="303.64" style="stroke:#000;stroke-width:0.8" id="line2d_5"></use><g transform="matrix(.1 0 0 -.1 274.56 318.238)" id="text_5"><defs><path id="DejaVuSans-31" d="M794 531h1031v3560L703 3866v575l1116 225h631V531h1031V0H794v531z" transform="scale(.01563)"></path></defs><use xlink:href="#DejaVuSans-31"></use><use xlink:href="#DejaVuSans-30" x="63.623"></use><use xlink:href="#DejaVuSans-30" x="127.246"></use><use xlink:href="#DejaVuSans-30" x="190.869"></use><use xlink:href="#DejaVuSans-30" x="254.492"></use></g></g><g id="xtick_6"><use xlink:href="#me048898c50" x="345.836" y="303.64" style="stroke:#000;stroke-width:0.8" id="line2d_6"></use><g transform="matrix(.1 0 0 -.1 329.93 318.238)" id="text_6"><use xlink:href="#DejaVuSans-31"></use><use xlink:href="#DejaVuSans-32" x="63.623"></use><use xlink:href="#DejaVuSans-35" x="127.246"></use><use xlink:href="#DejaVuSans-30" x="190.869"></use><use xlink:href="#DejaVuSans-30" x="254.492"></use></g></g><g id="xtick_7"><use xlink:href="#me048898c50" x="401.205" y="303.64" style="stroke:#000;stroke-width:0.8" id="line2d_7"></use><g transform="matrix(.1 0 0 -.1 385.3 318.238)" id="text_7"><use xlink:href="#DejaVuSans-31"></use><use xlink:href="#DejaVuSans-35" x="63.623"></use><use xlink:href="#DejaVuSans-30" x="127.246"></use><use xlink:href="#DejaVuSans-30" x="190.869"></use><use xlink:href="#DejaVuSans-30" x="254.492"></use></g></g><g transform="matrix(.1 0 0 -.1 224.156 331.917)" id="text_8"><defs><path id="DejaVuSans-62" d="M3116 1747q0 634-261 995t-717 361q-457 0-718-361t-261-995q0-634 261-995t718-361q456 0 717 361t261 995zM1159 2969q182 312 458 463 277 152 661 152 638 0 1036-506 399-506 399-1331T3314 415Q2916-91 2278-91q-384 0-661 152-276 152-458 464V0H581v4863h578V2969z" transform="scale(.01563)"></path><path id="DejaVuSans-75" d="M544 1381v2119h575V1403q0-497 193-746 194-248 582-248 465 0 735 297 271 297 271 810v1984h575V0h-575v538q-209-319-486-474-276-155-642-155-603 0-916 375-312 375-312 1097zm1447 2203z" transform="scale(.01563)"></path><path id="DejaVuSans-66" d="M2375 4863v-479h-550q-309 0-430-125-120-125-120-450v-309h947v-447h-947V0H697v3053H147v447h550v244q0 584 272 851 272 268 862 268h544z" transform="scale(.01563)"></path><path id="DejaVuSans-65" d="M3597 1894v-281H953q38-594 358-905t892-311q331 0 642 81t618 244V178Q3153 47 2828-22t-659-69q-838 0-1327 487-489 488-489 1320 0 859 464 1363 464 505 1252 505 706 0 1117-455 411-454 411-1235zm-575 169q-6 471-264 752-258 282-683 282-481 0-770-272t-333-766l2050 4z" transform="scale(.01563)"></path><path id="DejaVuSans-72" d="M2631 2963q-97 56-211 82-114 27-251 27-488 0-749-317t-261-911V0H581v3500h578v-544q182 319 472 473 291 155 707 155 59 0 131-8 72-7 159-23l3-590z" transform="scale(.01563)"></path><path id="DejaVuSans-73" d="M2834 3397v-544q-243 125-506 187-262 63-544 63-428 0-642-131t-214-394q0-200 153-314t616-217l197-44q612-131 870-370t258-667q0-488-386-773Q2250-91 1575-91q-281 0-586 55T347 128v594q319-166 628-249 309-82 613-82 406 0 624 139 219 139 219 392 0 234-158 359-157 125-692 241l-200 47q-534 112-772 345-237 233-237 639 0 494 350 762 350 269 994 269 318 0 599-47 282-46 519-140z" transform="scale(.01563)"></path><path id="DejaVuSans-69" d="M603 3500h575V0H603v3500zm0 1363h575v-729H603v729z" transform="scale(.01563)"></path><path id="DejaVuSans-7a" d="M353 3500h2731v-525L922 459h2162V0H275v525l2163 2516H353v459z" transform="scale(.01563)"></path></defs><use xlink:href="#DejaVuSans-62"></use><use xlink:href="#DejaVuSans-75" x="63.477"></use><use xlink:href="#DejaVuSans-66" x="126.855"></use><use xlink:href="#DejaVuSans-66" x="162.061"></use><use xlink:href="#DejaVuSans-65" x="197.266"></use><use xlink:href="#DejaVuSans-72" x="258.789"></use><use xlink:href="#DejaVuSans-20" x="299.902"></use><use xlink:href="#DejaVuSans-73" x="331.689"></use><use xlink:href="#DejaVuSans-69" x="383.789"></use><use xlink:href="#DejaVuSans-7a" x="411.572"></use><use xlink:href="#DejaVuSans-65" x="464.063"></use></g></g><g id="matplotlib.axis_2"><g id="ytick_1"><g id="line2d_8"><defs><path id="m52376ea7f7" d="M0 0h-3.5" style="stroke:#000;stroke-width:0.8"></path></defs><use xlink:href="#m52376ea7f7" x="50.87" y="292.587" style="stroke:#000;stroke-width:0.8"></use></g><use xlink:href="#DejaVuSans-30" transform="matrix(.1 0 0 -.1 37.508 296.386)" id="text_9"></use></g><g id="ytick_2"><use xlink:href="#m52376ea7f7" x="50.87" y="254.975" style="stroke:#000;stroke-width:0.8" id="line2d_9"></use><g transform="matrix(.1 0 0 -.1 24.782 258.774)" id="text_10"><use xlink:href="#DejaVuSans-31"></use><use xlink:href="#DejaVuSans-30" x="63.623"></use><use xlink:href="#DejaVuSans-30" x="127.246"></use></g></g><g id="ytick_3"><use xlink:href="#m52376ea7f7" x="50.87" y="217.362" style="stroke:#000;stroke-width:0.8" id="line2d_10"></use><g transform="matrix(.1 0 0 -.1 24.782 221.162)" id="text_11"><use xlink:href="#DejaVuSans-32"></use><use xlink:href="#DejaVuSans-30" x="63.623"></use><use xlink:href="#DejaVuSans-30" x="127.246"></use></g></g><g id="ytick_4"><use xlink:href="#m52376ea7f7" x="50.87" y="179.75" style="stroke:#000;stroke-width:0.8" id="line2d_11"></use><g transform="matrix(.1 0 0 -.1 24.782 183.55)" id="text_12"><defs><path id="DejaVuSans-33" d="M2597 2516q453-97 707-404 255-306 255-756 0-690-475-1069Q2609-91 1734-91q-293 0-604 58T488 141v609q262-153 574-231 313-78 654-78 593 0 904 234t311 681q0 413-289 645-289 233-804 233h-544v519h569q465 0 712 186t247 536q0 359-255 551-254 193-729 193-260 0-557-57-297-56-653-174v562q360 100 674 150t592 50q719 0 1137-327 419-326 419-882 0-388-222-655t-631-370z" transform="scale(.01563)"></path></defs><use xlink:href="#DejaVuSans-33"></use><use xlink:href="#DejaVuSans-30" x="63.623"></use><use xlink:href="#DejaVuSans-30" x="127.246"></use></g></g><g id="ytick_5"><use xlink:href="#m52376ea7f7" x="50.87" y="142.138" style="stroke:#000;stroke-width:0.8" id="line2d_12"></use><g transform="matrix(.1 0 0 -.1 24.782 145.937)" id="text_13"><defs><path id="DejaVuSans-34" d="M2419 4116 825 1625h1594v2491zm-166 550h794V1625h666v-525h-666V0h-628v1100H313v609l1940 2957z" transform="scale(.01563)"></path></defs><use xlink:href="#DejaVuSans-34"></use><use xlink:href="#DejaVuSans-30" x="63.623"></use><use xlink:href="#DejaVuSans-30" x="127.246"></use></g></g><g id="ytick_6"><use xlink:href="#m52376ea7f7" x="50.87" y="104.526" style="stroke:#000;stroke-width:0.8" id="line2d_13"></use><g transform="matrix(.1 0 0 -.1 24.782 108.325)" id="text_14"><use xlink:href="#DejaVuSans-35"></use><use xlink:href="#DejaVuSans-30" x="63.623"></use><use xlink:href="#DejaVuSans-30" x="127.246"></use></g></g><g id="ytick_7"><use xlink:href="#m52376ea7f7" x="50.87" y="66.913" style="stroke:#000;stroke-width:0.8" id="line2d_14"></use><g transform="matrix(.1 0 0 -.1 24.782 70.712)" id="text_15"><defs><path id="DejaVuSans-36" d="M2113 2584q-425 0-674-291-248-290-248-796 0-503 248-796 249-292 674-292t673 292q248 293 248 796 0 506-248 796-248 291-673 291zm1253 1979v-575q-238 112-480 171-242 60-480 60-625 0-955-422-329-422-376-1275 184 272 462 417 279 145 613 145 703 0 1111-427 408-426 408-1160 0-719-425-1154Q2819-91 2113-91q-810 0-1238 620-428 621-428 1799 0 1106 525 1764t1409 658q238 0 480-47t505-140z" transform="scale(.01563)"></path></defs><use xlink:href="#DejaVuSans-36"></use><use xlink:href="#DejaVuSans-30" x="63.623"></use><use xlink:href="#DejaVuSans-30" x="127.246"></use></g></g><g id="ytick_8"><use xlink:href="#m52376ea7f7" x="50.87" y="29.301" style="stroke:#000;stroke-width:0.8" id="line2d_15"></use><g transform="matrix(.1 0 0 -.1 24.782 33.1)" id="text_16"><use xlink:href="#DejaVuSans-37"></use><use xlink:href="#DejaVuSans-30" x="63.623"></use><use xlink:href="#DejaVuSans-30" x="127.246"></use></g></g><g transform="matrix(0 -.1 -.1 0 18.703 194.891)" id="text_17"><defs><path id="DejaVuSans-6c" d="M603 4863h575V0H603v4863z" transform="scale(.01563)"></path><path id="DejaVuSans-61" d="M2194 1759q-697 0-966-159t-269-544q0-306 202-486 202-179 548-179 479 0 768 339t289 901v128h-572zm1147 238V0h-575v531q-197-318-491-470T1556-91q-537 0-855 302-317 302-317 808 0 590 395 890 396 300 1180 300h807v57q0 397-261 614t-733 217q-300 0-585-72-284-72-546-216v532q315 122 612 182 297 61 578 61 760 0 1135-394 375-393 375-1193z" transform="scale(.01563)"></path><path id="DejaVuSans-74" d="M1172 4494v-994h1184v-447H1172V1153q0-428 117-550t477-122h590V0h-590q-666 0-919 248-253 249-253 905v1900H172v447h422v994h578z" transform="scale(.01563)"></path><path id="DejaVuSans-6e" d="M3513 2113V0h-575v2094q0 497-194 743-194 247-581 247-466 0-735-297-269-296-269-809V0H581v3500h578v-544q207 316 486 472 280 156 646 156 603 0 912-373 310-373 310-1098z" transform="scale(.01563)"></path><path id="DejaVuSans-63" d="M3122 3366v-538q-244 135-489 202t-495 67q-560 0-870-355-309-354-309-995t309-996q310-354 870-354 250 0 495 67t489 202V134Q2881 22 2623-34q-257-57-548-57-791 0-1257 497-465 497-465 1341 0 856 470 1346 471 491 1290 491 265 0 518-55 253-54 491-163z" transform="scale(.01563)"></path><path id="DejaVuSans-79" d="M2059-325q-243-625-475-815-231-191-618-191H506v481h338q237 0 368 113 132 112 291 531l103 262L191 3500h609L1894 763l1094 2737h609L2059-325z" transform="scale(.01563)"></path><path id="DejaVuSans-28" d="M1984 4856q-418-718-622-1422-203-703-203-1425 0-721 205-1429t620-1424h-500Q1016-109 783 600T550 2009q0 697 231 1403 232 707 703 1444h500z" transform="scale(.01563)"></path><path id="DejaVuSans-29" d="M513 4856h500q468-737 701-1444 233-706 233-1403 0-700-233-1409T1013-844H513q415 716 620 1424t205 1429q0 722-205 1425-205 704-620 1422z" transform="scale(.01563)"></path></defs><use xlink:href="#DejaVuSans-6c"></use><use xlink:href="#DejaVuSans-61" x="27.783"></use><use xlink:href="#DejaVuSans-74" x="89.063"></use><use xlink:href="#DejaVuSans-65" x="128.271"></use><use xlink:href="#DejaVuSans-6e" x="189.795"></use><use xlink:href="#DejaVuSans-63" x="253.174"></use><use xlink:href="#DejaVuSans-79" x="308.154"></use><use xlink:href="#DejaVuSans-20" x="367.334"></use><use xlink:href="#DejaVuSans-28" x="399.121"></use><use xlink:href="#DejaVuSans-75" x="438.135"></use><use xlink:href="#DejaVuSans-73" x="501.514"></use><use xlink:href="#DejaVuSans-29" x="553.613"></use></g></g><g id="line2d_16"><path d="m69.012 291.06.022-.075.045-.027.088.042.177-.004.355-.053.709-.03 1.417-.052 2.835.018 5.67-.127 11.34-.004 22.679-.015 45.358-.24 90.717-.238 181.434-1.06" clip-path="url(#pc941a3f1b8)" style="fill:none;stroke:#1f77b4;stroke-width:1.5;stroke-linecap:square"></path><defs><path id="m55587f0456" d="M0 3a3 3 0 1 0 0-6 3 3 0 0 0 0 6z" style="stroke:#1f77b4"></path></defs><g clip-path="url(#pc941a3f1b8)"><use xlink:href="#m55587f0456" x="69.012" y="291.06" style="fill:#1f77b4;stroke:#1f77b4"></use><use xlink:href="#m55587f0456" x="69.034" y="290.985" style="fill:#1f77b4;stroke:#1f77b4"></use><use xlink:href="#m55587f0456" x="69.079" y="290.958" style="fill:#1f77b4;stroke:#1f77b4"></use><use xlink:href="#m55587f0456" x="69.167" y="291" style="fill:#1f77b4;stroke:#1f77b4"></use><use xlink:href="#m55587f0456" x="69.344" y="290.996" style="fill:#1f77b4;stroke:#1f77b4"></use><use xlink:href="#m55587f0456" x="69.699" y="290.943" style="fill:#1f77b4;stroke:#1f77b4"></use><use xlink:href="#m55587f0456" x="70.408" y="290.913" style="fill:#1f77b4;stroke:#1f77b4"></use><use xlink:href="#m55587f0456" x="71.825" y="290.861" style="fill:#1f77b4;stroke:#1f77b4"></use><use xlink:href="#m55587f0456" x="74.66" y="290.879" style="fill:#1f77b4;stroke:#1f77b4"></use><use xlink:href="#m55587f0456" x="80.33" y="290.752" style="fill:#1f77b4;stroke:#1f77b4"></use><use xlink:href="#m55587f0456" x="91.669" y="290.748" style="fill:#1f77b4;stroke:#1f77b4"></use><use xlink:href="#m55587f0456" x="114.349" y="290.733" style="fill:#1f77b4;stroke:#1f77b4"></use><use xlink:href="#m55587f0456" x="159.707" y="290.492" style="fill:#1f77b4;stroke:#1f77b4"></use><use xlink:href="#m55587f0456" x="250.424" y="290.255" style="fill:#1f77b4;stroke:#1f77b4"></use><use xlink:href="#m55587f0456" x="431.858" y="289.194" style="fill:#1f77b4;stroke:#1f77b4"></use></g></g><g id="line2d_17"><path d="m69.012 257.028.022-13.217.045-34.298.088 14.973.177 1.057.355 13.39.709 38.602 1.417-2.092 2.835 1.242 5.67 1.203 11.34-.993 22.679-2.072 45.358-.087 90.717-.79 181.434.392" clip-path="url(#pc941a3f1b8)" style="fill:none;stroke:#ff7f0e;stroke-width:1.5;stroke-linecap:square"></path><defs><path id="m23eb9cdf11" d="M0 3a3 3 0 1 0 0-6 3 3 0 0 0 0 6z" style="stroke:#ff7f0e"></path></defs><g clip-path="url(#pc941a3f1b8)"><use xlink:href="#m23eb9cdf11" x="69.012" y="257.028" style="fill:#ff7f0e;stroke:#ff7f0e"></use><use xlink:href="#m23eb9cdf11" x="69.034" y="243.811" style="fill:#ff7f0e;stroke:#ff7f0e"></use><use xlink:href="#m23eb9cdf11" x="69.079" y="209.513" style="fill:#ff7f0e;stroke:#ff7f0e"></use><use xlink:href="#m23eb9cdf11" x="69.167" y="224.486" style="fill:#ff7f0e;stroke:#ff7f0e"></use><use xlink:href="#m23eb9cdf11" x="69.344" y="225.543" style="fill:#ff7f0e;stroke:#ff7f0e"></use><use xlink:href="#m23eb9cdf11" x="69.699" y="238.933" style="fill:#ff7f0e;stroke:#ff7f0e"></use><use xlink:href="#m23eb9cdf11" x="70.408" y="277.535" style="fill:#ff7f0e;stroke:#ff7f0e"></use><use xlink:href="#m23eb9cdf11" x="71.825" y="275.443" style="fill:#ff7f0e;stroke:#ff7f0e"></use><use xlink:href="#m23eb9cdf11" x="74.66" y="276.685" style="fill:#ff7f0e;stroke:#ff7f0e"></use><use xlink:href="#m23eb9cdf11" x="80.33" y="277.888" style="fill:#ff7f0e;stroke:#ff7f0e"></use><use xlink:href="#m23eb9cdf11" x="91.669" y="276.895" style="fill:#ff7f0e;stroke:#ff7f0e"></use><use xlink:href="#m23eb9cdf11" x="114.349" y="274.823" style="fill:#ff7f0e;stroke:#ff7f0e"></use><use xlink:href="#m23eb9cdf11" x="159.707" y="274.736" style="fill:#ff7f0e;stroke:#ff7f0e"></use><use xlink:href="#m23eb9cdf11" x="250.424" y="273.946" style="fill:#ff7f0e;stroke:#ff7f0e"></use><use xlink:href="#m23eb9cdf11" x="431.858" y="274.338" style="fill:#ff7f0e;stroke:#ff7f0e"></use></g></g><g id="line2d_18"><path d="m69.012 290.962.022-.538.045.015.088.027.177.293.355-.14.709-.503 1.417.335 2.835-.58 5.67-.485 11.34-.74 22.679-1.471 45.358-4.029 90.717-7.767 181.434-19.317" clip-path="url(#pc941a3f1b8)" style="fill:none;stroke:#2ca02c;stroke-width:1.5;stroke-linecap:square"></path><defs><path id="mc5587a6553" d="M0 3a3 3 0 1 0 0-6 3 3 0 0 0 0 6z" style="stroke:#2ca02c"></path></defs><g clip-path="url(#pc941a3f1b8)"><use xlink:href="#mc5587a6553" x="69.012" y="290.962" style="fill:#2ca02c;stroke:#2ca02c"></use><use xlink:href="#mc5587a6553" x="69.034" y="290.424" style="fill:#2ca02c;stroke:#2ca02c"></use><use xlink:href="#mc5587a6553" x="69.079" y="290.439" style="fill:#2ca02c;stroke:#2ca02c"></use><use xlink:href="#mc5587a6553" x="69.167" y="290.466" style="fill:#2ca02c;stroke:#2ca02c"></use><use xlink:href="#mc5587a6553" x="69.344" y="290.759" style="fill:#2ca02c;stroke:#2ca02c"></use><use xlink:href="#mc5587a6553" x="69.699" y="290.62" style="fill:#2ca02c;stroke:#2ca02c"></use><use xlink:href="#mc5587a6553" x="70.408" y="290.116" style="fill:#2ca02c;stroke:#2ca02c"></use><use xlink:href="#mc5587a6553" x="71.825" y="290.451" style="fill:#2ca02c;stroke:#2ca02c"></use><use xlink:href="#mc5587a6553" x="74.66" y="289.871" style="fill:#2ca02c;stroke:#2ca02c"></use><use xlink:href="#mc5587a6553" x="80.33" y="289.386" style="fill:#2ca02c;stroke:#2ca02c"></use><use xlink:href="#mc5587a6553" x="91.669" y="288.645" style="fill:#2ca02c;stroke:#2ca02c"></use><use xlink:href="#mc5587a6553" x="114.349" y="287.175" style="fill:#2ca02c;stroke:#2ca02c"></use><use xlink:href="#mc5587a6553" x="159.707" y="283.146" style="fill:#2ca02c;stroke:#2ca02c"></use><use xlink:href="#mc5587a6553" x="250.424" y="275.379" style="fill:#2ca02c;stroke:#2ca02c"></use><use xlink:href="#mc5587a6553" x="431.858" y="256.062" style="fill:#2ca02c;stroke:#2ca02c"></use></g></g><g id="line2d_19"><path d="m69.012 283.214.022-.075.045-10.046.088-26.434.177-40.734.355 23.635.709-18.648 1.417-33.17 2.835-3.8 5.67 26.333 11.34-2.475 22.679-15.823 45.358 58.476 90.717-30.745L431.858 39.46" clip-path="url(#pc941a3f1b8)" style="fill:none;stroke:#d62728;stroke-width:1.5;stroke-linecap:square"></path><defs><path id="mf3d9a176c9" d="M0 3a3 3 0 1 0 0-6 3 3 0 0 0 0 6z" style="stroke:#d62728"></path></defs><g clip-path="url(#pc941a3f1b8)"><use xlink:href="#mf3d9a176c9" x="69.012" y="283.214" style="fill:#d62728;stroke:#d62728"></use><use xlink:href="#mf3d9a176c9" x="69.034" y="283.139" style="fill:#d62728;stroke:#d62728"></use><use xlink:href="#mf3d9a176c9" x="69.079" y="273.093" style="fill:#d62728;stroke:#d62728"></use><use xlink:href="#mf3d9a176c9" x="69.167" y="246.659" style="fill:#d62728;stroke:#d62728"></use><use xlink:href="#mf3d9a176c9" x="69.344" y="205.925" style="fill:#d62728;stroke:#d62728"></use><use xlink:href="#mf3d9a176c9" x="69.699" y="229.56" style="fill:#d62728;stroke:#d62728"></use><use xlink:href="#mf3d9a176c9" x="70.408" y="210.912" style="fill:#d62728;stroke:#d62728"></use><use xlink:href="#mf3d9a176c9" x="71.825" y="177.742" style="fill:#d62728;stroke:#d62728"></use><use xlink:href="#mf3d9a176c9" x="74.66" y="173.943" style="fill:#d62728;stroke:#d62728"></use><use xlink:href="#mf3d9a176c9" x="80.33" y="200.275" style="fill:#d62728;stroke:#d62728"></use><use xlink:href="#mf3d9a176c9" x="91.669" y="197.8" style="fill:#d62728;stroke:#d62728"></use><use xlink:href="#mf3d9a176c9" x="114.349" y="181.977" style="fill:#d62728;stroke:#d62728"></use><use xlink:href="#mf3d9a176c9" x="159.707" y="240.453" style="fill:#d62728;stroke:#d62728"></use><use xlink:href="#mf3d9a176c9" x="250.424" y="209.708" style="fill:#d62728;stroke:#d62728"></use><use xlink:href="#mf3d9a176c9" x="431.858" y="39.46" style="fill:#d62728;stroke:#d62728"></use></g></g><path d="M50.87 303.64V26.88" style="fill:none;stroke:#000;stroke-width:0.8;stroke-linejoin:miter;stroke-linecap:square" id="patch_3"></path><path d="M450 303.64V26.88" style="fill:none;stroke:#000;stroke-width:0.8;stroke-linejoin:miter;stroke-linecap:square" id="patch_4"></path><path d="M50.87 303.64H450" style="fill:none;stroke:#000;stroke-width:0.8;stroke-linejoin:miter;stroke-linecap:square" id="patch_5"></path><path d="M50.87 26.88H450" style="fill:none;stroke:#000;stroke-width:0.8;stroke-linejoin:miter;stroke-linecap:square" id="patch_6"></path><g transform="matrix(.12 0 0 -.12 54.082 20.88)" id="text_18"><defs><path id="DejaVuSans-54" d="M-19 4666h3947v-532H2272V0h-634v4134H-19v532z" transform="scale(.01563)"></path><path id="DejaVuSans-68" d="M3513 2113V0h-575v2094q0 497-194 743-194 247-581 247-466 0-735-297-269-296-269-809V0H581v4863h578V2956q207 316 486 472 280 156 646 156 603 0 912-373 310-373 310-1098z" transform="scale(.01563)"></path><path id="DejaVuSans-6d" d="M3328 2828q216 388 516 572t706 184q547 0 844-383 297-382 297-1088V0h-578v2094q0 503-179 746-178 244-543 244-447 0-707-297-259-296-259-809V0h-578v2094q0 506-178 748t-550 242q-441 0-701-298-259-298-259-808V0H581v3500h578v-544q197 322 472 475t653 153q382 0 649-194 267-193 395-562z" transform="scale(.01563)"></path><path id="DejaVuSans-70" d="M1159 525v-1856H581v4831h578v-531q182 312 458 463 277 152 661 152 638 0 1036-506 399-506 399-1331T3314 415Q2916-91 2278-91q-384 0-661 152-276 152-458 464zm1957 1222q0 634-261 995t-717 361q-457 0-718-361t-261-995q0-634 261-995t718-361q456 0 717 361t261 995z" transform="scale(.01563)"></path><path id="DejaVuSans-6f" d="M1959 3097q-462 0-731-361t-269-989q0-628 267-989 268-361 733-361 460 0 728 362 269 363 269 988 0 622-269 986-268 364-728 364zm0 487q750 0 1178-488 429-487 429-1349 0-859-429-1349Q2709-91 1959-91q-753 0-1180 489-426 490-426 1349 0 862 426 1349 427 488 1180 488z" transform="scale(.01563)"></path><path id="DejaVuSans-47" d="M3809 666v1253H2778v519h1656V434q-365-259-806-392-440-133-940-133-1094 0-1712 639-617 640-617 1780 0 1144 617 1783 618 639 1712 639 456 0 867-113 411-112 758-331v-672q-350 297-744 447t-828 150q-857 0-1287-478-429-478-429-1425 0-944 429-1422 430-478 1287-478 334 0 596 58 263 58 472 180z" transform="scale(.01563)"></path><path id="DejaVuSans-50" d="M1259 4147V2394h794q441 0 681 228 241 228 241 650 0 419-241 647-240 228-681 228h-794zm-631 519h1425q785 0 1186-355 402-355 402-1039 0-691-402-1044-401-353-1186-353h-794V0H628v4666z" transform="scale(.01563)"></path><path id="DejaVuSans-55" d="M556 4666h635V1831q0-750 271-1080 272-329 882-329 606 0 878 329 272 330 272 1080v2835h634V1753q0-912-452-1378Q3225-91 2344-91q-885 0-1337 466-451 466-451 1378v2913z" transform="scale(.01563)"></path></defs><use xlink:href="#DejaVuSans-54"></use><use xlink:href="#DejaVuSans-68" x="61.084"></use><use xlink:href="#DejaVuSans-65" x="124.463"></use><use xlink:href="#DejaVuSans-20" x="185.986"></use><use xlink:href="#DejaVuSans-69" x="217.773"></use><use xlink:href="#DejaVuSans-6d" x="245.557"></use><use xlink:href="#DejaVuSans-70" x="342.969"></use><use xlink:href="#DejaVuSans-61" x="406.445"></use><use xlink:href="#DejaVuSans-63" x="467.725"></use><use xlink:href="#DejaVuSans-74" x="522.705"></use><use xlink:href="#DejaVuSans-20" x="561.914"></use><use xlink:href="#DejaVuSans-6f" x="593.701"></use><use xlink:href="#DejaVuSans-66" x="654.883"></use><use xlink:href="#DejaVuSans-20" x="690.088"></use><use xlink:href="#DejaVuSans-47" x="721.875"></use><use xlink:href="#DejaVuSans-50" x="799.365"></use><use xlink:href="#DejaVuSans-55" x="859.668"></use><use xlink:href="#DejaVuSans-20" x="932.861"></use><use xlink:href="#DejaVuSans-6f" x="964.648"></use><use xlink:href="#DejaVuSans-70" x="1025.83"></use><use xlink:href="#DejaVuSans-74" x="1089.307"></use><use xlink:href="#DejaVuSans-69" x="1128.516"></use><use xlink:href="#DejaVuSans-6d" x="1156.299"></use><use xlink:href="#DejaVuSans-69" x="1253.711"></use><use xlink:href="#DejaVuSans-7a" x="1281.494"></use><use xlink:href="#DejaVuSans-61" x="1333.984"></use><use xlink:href="#DejaVuSans-74" x="1395.264"></use><use xlink:href="#DejaVuSans-69" x="1434.473"></use><use xlink:href="#DejaVuSans-6f" x="1462.256"></use><use xlink:href="#DejaVuSans-6e" x="1523.438"></use><use xlink:href="#DejaVuSans-73" x="1586.816"></use><use xlink:href="#DejaVuSans-20" x="1638.916"></use><use xlink:href="#DejaVuSans-6f" x="1670.703"></use><use xlink:href="#DejaVuSans-6e" x="1731.885"></use><use xlink:href="#DejaVuSans-20" x="1795.264"></use><use xlink:href="#DejaVuSans-63" x="1827.051"></use><use xlink:href="#DejaVuSans-6f" x="1882.031"></use><use xlink:href="#DejaVuSans-6d" x="1943.213"></use><use xlink:href="#DejaVuSans-6d" x="2040.625"></use><use xlink:href="#DejaVuSans-75" x="2138.037"></use><use xlink:href="#DejaVuSans-6e" x="2201.416"></use><use xlink:href="#DejaVuSans-69" x="2264.795"></use><use xlink:href="#DejaVuSans-63" x="2292.578"></use><use xlink:href="#DejaVuSans-61" x="2347.559"></use><use xlink:href="#DejaVuSans-74" x="2408.838"></use><use xlink:href="#DejaVuSans-69" x="2448.047"></use><use xlink:href="#DejaVuSans-6f" x="2475.83"></use><use xlink:href="#DejaVuSans-6e" x="2537.012"></use><use xlink:href="#DejaVuSans-20" x="2600.391"></use><use xlink:href="#DejaVuSans-70" x="2632.178"></use><use xlink:href="#DejaVuSans-65" x="2695.654"></use><use xlink:href="#DejaVuSans-72" x="2757.178"></use><use xlink:href="#DejaVuSans-66" x="2798.291"></use><use xlink:href="#DejaVuSans-6f" x="2833.496"></use><use xlink:href="#DejaVuSans-72" x="2894.678"></use><use xlink:href="#DejaVuSans-6d" x="2934.041"></use><use xlink:href="#DejaVuSans-61" x="3031.453"></use><use xlink:href="#DejaVuSans-6e" x="3092.732"></use><use xlink:href="#DejaVuSans-63" x="3156.111"></use><use xlink:href="#DejaVuSans-65" x="3211.092"></use></g><g id="legend_1"><path d="M57.87 93.593h171.531q2 0 2-2V33.88q0-2-2-2H57.87q-2 0-2 2v57.712q0 2 2 2z" style="fill:#fff;opacity:0.8;stroke:#ccc;stroke-linejoin:miter" id="patch_7"></path><g id="line2d_20"><path d="M59.87 39.978h20" style="fill:none;stroke:#1f77b4;stroke-width:1.5;stroke-linecap:square"></path><use xlink:href="#m55587f0456" x="69.87" y="39.978" style="fill:#1f77b4;stroke:#1f77b4"></use></g><g transform="matrix(.1 0 0 -.1 87.87 43.478)" id="text_19"><defs><path id="DejaVuSans-44" d="M1259 4147V519h763q966 0 1414 437 448 438 448 1382 0 937-448 1373t-1414 436h-763zm-631 519h1297q1356 0 1990-564 635-564 635-1764 0-1207-638-1773Q3275 0 1925 0H628v4666z" transform="scale(.01563)"></path><path id="DejaVuSans-52" d="M2841 2188q203-69 395-294t386-619L4263 0h-679l-596 1197q-232 469-449 622t-592 153h-688V0H628v4666h1425q800 0 1194-335 394-334 394-1009 0-441-205-732-205-290-595-402zM1259 4147V2491h794q456 0 689 211t233 620q0 409-233 617t-689 208h-794z" transform="scale(.01563)"></path><path id="DejaVuSans-4d" d="M628 4666h941l1190-3175 1197 3175h941V0h-616v4097L3078 897h-634L1241 4097V0H628v4666z" transform="scale(.01563)"></path><path id="DejaVuSans-41" d="m2188 4044-857-2322h1716l-859 2322zm-357 622h716L4325 0h-656l-425 1197H1141L716 0H50l1781 4666z" transform="scale(.01563)"></path><path id="DejaVuSans-2b" d="M2944 4013V2272h1740v-531H2944V0h-525v1741H678v531h1741v1741h525z" transform="scale(.01563)"></path><path id="DejaVuSans-67" d="M2906 1791q0 625-258 968-257 344-723 344-462 0-720-344-258-343-258-968 0-622 258-966t720-344q466 0 723 344 258 344 258 966zm575-1357q0-893-397-1329-396-436-1215-436-303 0-572 45t-522 139v559q253-137 500-202 247-66 503-66 566 0 847 295t281 892v285q-178-310-456-463T1784 0Q1141 0 747 490 353 981 353 1791q0 812 394 1302 394 491 1037 491 388 0 666-153t456-462v531h575V434z" transform="scale(.01563)"></path><path id="DejaVuSans-64" d="M2906 2969v1894h575V0h-575v525q-181-312-458-464-276-152-664-152-634 0-1033 506-398 507-398 1332t398 1331q399 506 1033 506 388 0 664-152 277-151 458-463zM947 1747q0-634 261-995t717-361q456 0 718 361 263 361 263 995t-263 995q-262 361-718 361t-717-361q-261-361-261-995z" transform="scale(.01563)"></path></defs><use xlink:href="#DejaVuSans-47"></use><use xlink:href="#DejaVuSans-50" x="77.49"></use><use xlink:href="#DejaVuSans-55" x="137.793"></use><use xlink:href="#DejaVuSans-44" x="210.986"></use><use xlink:href="#DejaVuSans-69" x="287.988"></use><use xlink:href="#DejaVuSans-72" x="315.771"></use><use xlink:href="#DejaVuSans-65" x="354.635"></use><use xlink:href="#DejaVuSans-63" x="416.158"></use><use xlink:href="#DejaVuSans-74" x="471.139"></use><use xlink:href="#DejaVuSans-20" x="510.348"></use><use xlink:href="#DejaVuSans-52" x="542.135"></use><use xlink:href="#DejaVuSans-44" x="611.617"></use><use xlink:href="#DejaVuSans-4d" x="688.619"></use><use xlink:href="#DejaVuSans-41" x="774.898"></use><use xlink:href="#DejaVuSans-20" x="843.307"></use><use xlink:href="#DejaVuSans-2b" x="875.094"></use><use xlink:href="#DejaVuSans-20" x="958.883"></use><use xlink:href="#DejaVuSans-67" x="990.67"></use><use xlink:href="#DejaVuSans-64" x="1054.146"></use><use xlink:href="#DejaVuSans-72" x="1117.623"></use><use xlink:href="#DejaVuSans-63" x="1156.486"></use><use xlink:href="#DejaVuSans-6f" x="1211.467"></use><use xlink:href="#DejaVuSans-70" x="1272.648"></use><use xlink:href="#DejaVuSans-79" x="1336.125"></use></g><g id="line2d_21"><path d="M59.87 54.657h20" style="fill:none;stroke:#ff7f0e;stroke-width:1.5;stroke-linecap:square"></path><use xlink:href="#m23eb9cdf11" x="69.87" y="54.657" style="fill:#ff7f0e;stroke:#ff7f0e"></use></g><g transform="matrix(.1 0 0 -.1 87.87 58.157)" id="text_20"><use xlink:href="#DejaVuSans-47"></use><use xlink:href="#DejaVuSans-50" x="77.49"></use><use xlink:href="#DejaVuSans-55" x="137.793"></use><use xlink:href="#DejaVuSans-44" x="210.986"></use><use xlink:href="#DejaVuSans-69" x="287.988"></use><use xlink:href="#DejaVuSans-72" x="315.771"></use><use xlink:href="#DejaVuSans-65" x="354.635"></use><use xlink:href="#DejaVuSans-63" x="416.158"></use><use xlink:href="#DejaVuSans-74" x="471.139"></use><use xlink:href="#DejaVuSans-20" x="510.348"></use><use xlink:href="#DejaVuSans-52" x="542.135"></use><use xlink:href="#DejaVuSans-44" x="611.617"></use><use xlink:href="#DejaVuSans-4d" x="688.619"></use><use xlink:href="#DejaVuSans-41" x="774.898"></use><use xlink:href="#DejaVuSans-20" x="843.307"></use><use xlink:href="#DejaVuSans-6f" x="875.094"></use><use xlink:href="#DejaVuSans-6e" x="936.275"></use><use xlink:href="#DejaVuSans-6c" x="999.654"></use><use xlink:href="#DejaVuSans-79" x="1027.438"></use></g><g id="line2d_22"><path d="M59.87 69.335h20" style="fill:none;stroke:#2ca02c;stroke-width:1.5;stroke-linecap:square"></path><use xlink:href="#mc5587a6553" x="69.87" y="69.335" style="fill:#2ca02c;stroke:#2ca02c"></use></g><g transform="matrix(.1 0 0 -.1 87.87 72.835)" id="text_21"><use xlink:href="#DejaVuSans-67"></use><use xlink:href="#DejaVuSans-64" x="63.477"></use><use xlink:href="#DejaVuSans-72" x="126.953"></use><use xlink:href="#DejaVuSans-63" x="165.816"></use><use xlink:href="#DejaVuSans-6f" x="220.797"></use><use xlink:href="#DejaVuSans-70" x="281.979"></use><use xlink:href="#DejaVuSans-79" x="345.455"></use><use xlink:href="#DejaVuSans-20" x="404.635"></use><use xlink:href="#DejaVuSans-6f" x="436.422"></use><use xlink:href="#DejaVuSans-6e" x="497.604"></use><use xlink:href="#DejaVuSans-6c" x="560.982"></use><use xlink:href="#DejaVuSans-79" x="588.766"></use></g><g id="line2d_23"><path d="M59.87 84.013h20" style="fill:none;stroke:#d62728;stroke-width:1.5;stroke-linecap:square"></path><use xlink:href="#mf3d9a176c9" x="69.87" y="84.013" style="fill:#d62728;stroke:#d62728"></use></g><g transform="matrix(.1 0 0 -.1 87.87 87.513)" id="text_22"><use xlink:href="#DejaVuSans-6e"></use><use xlink:href="#DejaVuSans-6f" x="63.379"></use><use xlink:href="#DejaVuSans-20" x="124.561"></use><use xlink:href="#DejaVuSans-47" x="156.348"></use><use xlink:href="#DejaVuSans-50" x="233.838"></use><use xlink:href="#DejaVuSans-55" x="294.141"></use><use xlink:href="#DejaVuSans-20" x="367.334"></use><use xlink:href="#DejaVuSans-6f" x="399.121"></use><use xlink:href="#DejaVuSans-70" x="460.303"></use><use xlink:href="#DejaVuSans-74" x="523.779"></use><use xlink:href="#DejaVuSans-69" x="562.988"></use><use xlink:href="#DejaVuSans-6d" x="590.771"></use><use xlink:href="#DejaVuSans-69" x="688.184"></use><use xlink:href="#DejaVuSans-7a" x="715.967"></use><use xlink:href="#DejaVuSans-61" x="768.457"></use><use xlink:href="#DejaVuSans-74" x="829.736"></use><use xlink:href="#DejaVuSans-69" x="868.945"></use><use xlink:href="#DejaVuSans-6f" x="896.729"></use><use xlink:href="#DejaVuSans-6e" x="957.91"></use></g></g></g></g><defs><clipPath id="pc941a3f1b8"><path d="M50.87 26.88H450v276.76H50.87z"></path></clipPath></defs></svg></div><div role="tabpanel" class="tabItem_Ymn6" hidden="">Both GPUDirect RDMA and gdrcopy enabled (Device to Device)<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ mpirun -H juliet3,juliet4 -x LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/apps/manual_install/gdrcopy/lib -x UCX_IB_GPU_DIRECT_RDMA=1 -x UCX_TLS=all -x UCX_NET_DEVICES=mlx5_0:1 -np 2 c/mpi/pt2pt/standard/osu_latency -d cuda D D</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># OSU MPI-CUDA Latency Test v7.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Send Buffer on DEVICE (D) and Receive Buffer on DEVICE (D)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Size          Latency (us)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Datatype: MPI_CHAR.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1                       4.06</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2                       4.26</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4                       4.33</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">8                       4.22</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">16                      4.23</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">32                      4.37</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">64                      4.45</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">128                     4.59</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">256                     4.54</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">512                     4.88</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1024                    4.89</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2048                    4.93</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4096                    5.57</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">8192                    6.20</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">16384                   9.02</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">32768                  12.15</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">65536                  18.42</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">131072                 31.48</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">262144                 56.07</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">524288                 43.67</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1048576                74.08</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2097152               145.56</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4194304               281.57</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden="">GPUDirect RDMA enabled and gdrcopy disabled (Device to Device)<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ mpirun -H juliet3,juliet4 -x LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/apps/manual_install/gdrcopy/lib -x UCX_IB_GPU_DIRECT_RDMA=1 -x UCX_TLS=^gdr_copy -x UCX_NET_DEVICES=mlx5_0:1 -np 2 c/mpi/pt2pt/standard/osu_latency -d cuda D D</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># OSU MPI-CUDA Latency Test v7.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Send Buffer on DEVICE (D) and Receive Buffer on DEVICE (D)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Size          Latency (us)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Datatype: MPI_CHAR.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1                      94.54</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2                     129.68</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4                     220.87</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">8                     181.06</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">16                    178.25</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">32                    142.65</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">64                     40.02</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">128                    45.58</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">256                    42.28</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">512                    39.08</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1024                   41.72</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2048                   47.23</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4096                   47.46</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">8192                   49.56</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">16384                  48.52</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">32768                 176.01</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">65536                 284.82</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">131072                238.62</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">262144                343.78</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">524288                 38.15</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1048576                70.01</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2097152               133.14</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4194304               264.97</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden="">GPUDirect RDMA disabled and gdrcopy enabled (Device to Device)<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ mpirun -H juliet3,juliet4 -x LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/apps/manual_install/gdrcopy/lib -x UCX_IB_GPU_DIRECT_RDMA=0 -x UCX_TLS=all -x UCX_NET_DEVICES=mlx5_0:1 -np 2 c/mpi/pt2pt/standard/osu_latency -d cuda D D</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># OSU MPI-CUDA Latency Test v7.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Send Buffer on DEVICE (D) and Receive Buffer on DEVICE (D)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Size          Latency (us)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Datatype: MPI_CHAR.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1                       4.32</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2                       5.75</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4                       5.71</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">8                       5.64</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">16                      4.86</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">32                      5.23</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">64                      6.57</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">128                     5.68</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">256                     7.22</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">512                     8.51</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1024                   10.48</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2048                   14.39</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4096                   25.10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">8192                   45.75</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">16384                  97.11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">32768                 752.08</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">65536                 994.36</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">131072               1725.03</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">262144               3549.30</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">524288                109.51</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1048576               166.81</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2097152               268.49</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4194304               443.22</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden="">Both GPUDirect RDMA and gdrcopy disabled (Device to Device)<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ mpirun -H juliet3,juliet4 -x LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/apps/manual_install/gdrcopy/lib -x UCX_IB_GPU_DIRECT_RDMA=0 -x UCX_TLS=^gdr_copy -x UCX_NET_DEVICES=mlx5_0:1 -np 2 c/mpi/pt2pt/standard/osu_latency -d cuda D D</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># OSU MPI-CUDA Latency Test v7.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Send Buffer on DEVICE (D) and Receive Buffer on DEVICE (D)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Size          Latency (us)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Datatype: MPI_CHAR.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1                      24.92</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2                      25.12</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4                      51.83</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">8                     122.11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">16                    230.41</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">32                    167.57</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">64                    217.15</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">128                   305.34</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">256                   315.44</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">512                   245.43</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1024                  252.01</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2048                  294.08</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4096                  138.61</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">8192                  220.35</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">16384                 672.99</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">32768                1189.99</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">65536                1197.14</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">131072               1714.11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">262144                928.49</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">524288                101.82</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1048576               161.01</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2097152               251.90</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4194304               432.20</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="manual-tunning-parameters">Manual tunning parameters<a href="#manual-tunning-parameters" class="hash-link" aria-label="Direct link to Manual tunning parameters" title="Direct link to Manual tunning parameters">​</a></h4><p>For all the runs above we need to specify the location of the gdrcopy library via <code>-x LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/apps/manual_install/gdrcopy/lib</code>. Without this option, the MPI library could not use gdrcopy, resulting in performance degradation. We also select the same Infiniband MCA for all our runs via <code>x UCX_NET_DEVICES=mlx5_0:1 </code>. This was done for reproducibility issues. To learn more about possible UCX options and manual tunning please visit the <a href="https://openucx.readthedocs.io/en/master/faq.html?highlight=uct#working-with-gpu" target="_blank" rel="noopener noreferrer">OpenUCX website</a>.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/MesoNET/user-documentation/tree/main/docs/juliet/MPI/MPI_CUDA_aware_Installation_Guide.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/documentation/user-documentation/juliet/Apptainer/Building_NGC_Containers"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Nvidia NGC catalog</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/documentation/user-documentation/juliet/adresses_vm"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">adresses_vm</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#setting-up-and-building-ucx-with-gpu-support" class="table-of-contents__link toc-highlight">Setting up and building UCX with GPU support</a><ul><li><a href="#gpu-communication-performance" class="table-of-contents__link toc-highlight">GPU communication performance</a></li><li><a href="#building-ucx" class="table-of-contents__link toc-highlight">Building UCX</a></li></ul></li><li><a href="#setting-up-and-building-openmpi" class="table-of-contents__link toc-highlight">Setting up and building OpenMPI</a></li><li><a href="#openmpi-performance-tests" class="table-of-contents__link toc-highlight">OpenMPI performance tests</a><ul><li><a href="#building-osu-micro-benchmarks" class="table-of-contents__link toc-highlight">Building OSU Micro-Benchmarks</a></li><li><a href="#running-osu-micro-benchmarks" class="table-of-contents__link toc-highlight">Running OSU Micro-Benchmarks</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"></div></footer></div>
<script src="/documentation/user-documentation/assets/js/runtime~main.a7b5a4c7.js"></script>
<script src="/documentation/user-documentation/assets/js/main.7dfe1b35.js"></script>
</body>
</html>