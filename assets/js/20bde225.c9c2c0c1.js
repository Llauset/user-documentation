"use strict";(self.webpackChunkmesodocs=self.webpackChunkmesodocs||[]).push([[6871],{4137:(e,t,n)=>{n.d(t,{Zo:()=>m,kt:()=>k});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},s=Object.keys(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),p=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},m=function(e){var t=p(e.components);return a.createElement(l.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,s=e.originalType,l=e.parentName,m=o(e,["components","mdxType","originalType","parentName"]),u=p(n),c=r,k=u["".concat(l,".").concat(c)]||u[c]||d[c]||s;return n?a.createElement(k,i(i({ref:t},m),{},{components:n})):a.createElement(k,i({ref:t},m))}));function k(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var s=n.length,i=new Array(s);i[0]=c;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o[u]="string"==typeof e?e:r,i[1]=o;for(var p=2;p<s;p++)i[p]=n[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},9898:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>d,frontMatter:()=>s,metadata:()=>o,toc:()=>p});var a=n(7462),r=(n(7294),n(4137));const s={title:"Soumettre et g\xe9rer ses travaux",sidebar_position:1},i="Soumettre ses travaux avec slurm",o={unversionedId:"HOWTO/slurm/submit",id:"HOWTO/slurm/submit",title:"Soumettre et g\xe9rer ses travaux",description:"Les exemples donn\xe9s ici doivent \xe9ventuellement \xeatre adapt\xe9s au sp\xe9cificit\xe9s de chaque machine, par exemple en sp\xe9cifiant l'option --partition etc.",source:"@site/docs/HOWTO/slurm/submit.md",sourceDirName:"HOWTO/slurm",slug:"/HOWTO/slurm/submit",permalink:"/documentation/user-documentation/HOWTO/slurm/submit",draft:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{title:"Soumettre et g\xe9rer ses travaux",sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"Intro",permalink:"/documentation/user-documentation/HOWTO/slurm/"},next:{title:"Monitoring",permalink:"/documentation/user-documentation/HOWTO/slurm/monitor"}},l={},p=[{value:"Soumission de scripts avec sbatch",id:"soumission-de-scripts-avec-sbatch",level:2},{value:"<code>--time</code>, <code>-t</code>",id:"--time--t",level:3},{value:"<code>--partition</code>, <code>-p</code>",id:"--partition--p",level:3},{value:"<code>--nodes</code>, <code>-N</code>",id:"--nodes--n",level:3},{value:"<code>--ntasks</code>, <code>-n</code>",id:"--ntasks--n",level:3},{value:"<code>--ntasks-per-node</code>",id:"--ntasks-per-node",level:3},{value:"<code>--cpus-per-task</code>",id:"--cpus-per-task",level:3},{value:"<code>--mem</code>",id:"--mem",level:3},{value:"<code>--reservation</code>",id:"--reservation",level:3},{value:"<code>--gpus</code>, <code>-G</code>",id:"opt-gpus",level:3},{value:"<code>--gpus-per-node</code>",id:"opt-gpus-per-node",level:3},{value:"<code>--gres</code>",id:"opt-gres",level:3},{value:"<code>--job-name</code>, <code>-J</code>",id:"--job-name--j",level:3},{value:"<code>--mail-user</code>",id:"--mail-user",level:3},{value:"<code>--output</code>, <code>-o</code> ",id:"--output--o-",level:3}],m={toc:p},u="wrapper";function d(e){let{components:t,...n}=e;return(0,r.kt)(u,(0,a.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"soumettre-ses-travaux-avec-slurm"},"Soumettre ses travaux avec slurm"),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"Les exemples donn\xe9s ici doivent \xe9ventuellement \xeatre adapt\xe9s au sp\xe9cificit\xe9s de chaque machine, par exemple en sp\xe9cifiant l'option ",(0,r.kt)("inlineCode",{parentName:"p"},"--partition")," etc.")),(0,r.kt)("h2",{id:"soumission-de-scripts-avec-sbatch"},"Soumission de scripts avec ",(0,r.kt)("a",{parentName:"h2",href:"https://slurm.schedmd.com/sbatch.html"},"sbatch")),(0,r.kt)("p",null,"La soumission d'un job se fait avec la commande"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"}," sbatch job.slurm\n")),(0,r.kt)("p",null,"o\xf9 ",(0,r.kt)("inlineCode",{parentName:"p"},"job.slurm")," est un script de soumission slurm.\nIl s'agit d'un script bash qui contient des instructions pour le gestionnaire de travaux ainsi que pour le lancement de votre programme.\nLes instructions pour slurm (c'est-\xe0-dire les options de la commande ",(0,r.kt)("inlineCode",{parentName:"p"},"sbatch"),") sont typiquement inclus dans l'en-t\xeate du script, pr\xe9c\xe9d\xe9 de ",(0,r.kt)("inlineCode",{parentName:"p"},"#SBATCH"),"."),(0,r.kt)("p",null,"Par exemple, le script de soumission suivant"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"#!/bin/bash\n#SBATCH --nodes=1\n#SBATCH --ntasks-per-node=1\n#SBATCH --cpus-per-task=1\n#SBATCH --time=00:10:00\n\nhostname\nsleep 60\n")),(0,r.kt)("p",null,"d\xe9crit un job qui ex\xe9cutera la commande ",(0,r.kt)("inlineCode",{parentName:"p"},"hostname")," suivi de la commande ",(0,r.kt)("inlineCode",{parentName:"p"},"sleep 60"),".\nCe job ",(0,r.kt)("em",{parentName:"p"},"single node")," (",(0,r.kt)("inlineCode",{parentName:"p"},"--nodes=1"),") consiste en une seule t\xe2che (",(0,r.kt)("inlineCode",{parentName:"p"},"--ntasks-per-node=1"),") mono-c\u0153ur (",(0,r.kt)("inlineCode",{parentName:"p"},"--cpus-per-task=1"),") avec un temps d'ex\xe9cution d'au plus 10 minutes."),(0,r.kt)("p",null,"La commande ",(0,r.kt)("inlineCode",{parentName:"p"},"sbatch job.slurm")," rajoute le job \xe0 la file d'attente et retourne un num\xe9ro de job (SLURM_JOB_ID), qui permet notamment de suivre l'\xe9tat du job."),(0,r.kt)("p",null,"En fonction des ressources demand\xe9es et l'\xe9tat du cluster, slurm lance le job et redirige la sortie standard (ici le nom du n\u0153ud allou\xe9) vers un fichier ",(0,r.kt)("inlineCode",{parentName:"p"},"slurm-%j.out")," (o\xf9 ",(0,r.kt)("inlineCode",{parentName:"p"},"%j")," est le SLURM_JOB_ID) localis\xe9 dans le dossier de lancement. Le job se termine soit quand la fin du script est atteint, soit quand le temps maximal (ici 10 minutes) est atteint."),(0,r.kt)("p",null,"Les arguments de sbatch peuvent \xe9galement \xeatre pass\xe9s directement en ligne de commande. Par exemple,"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"sbatch --output=out.txt job.slurm\n")),(0,r.kt)("p",null,"soumet le script pr\xe9c\xe9dent mais rajoute l'option ",(0,r.kt)("inlineCode",{parentName:"p"},"--output")," pour utiliser un fichier ",(0,r.kt)("inlineCode",{parentName:"p"},"out.txt")," \xe0 la place de ",(0,r.kt)("inlineCode",{parentName:"p"},"slurm-%j.out"),"."),(0,r.kt)("p",null,"La documentation compl\xe8te de ",(0,r.kt)("inlineCode",{parentName:"p"},"sbatch")," est disponible ",(0,r.kt)("a",{parentName:"p",href:"https://slurm.schedmd.com/sbatch.html"},"ici")," ou en consultant ",(0,r.kt)("inlineCode",{parentName:"p"},"man sbatch"),"."),(0,r.kt)("p",null,"Nous nous limitons ici aux options les plus importantes."),(0,r.kt)("h3",{id:"--time--t"},(0,r.kt)("a",{parentName:"h3",href:"https://slurm.schedmd.com/sbatch.html#OPT_time"},(0,r.kt)("inlineCode",{parentName:"a"},"--time"),", ",(0,r.kt)("inlineCode",{parentName:"a"},"-t"))),(0,r.kt)("p",null,"Exemples:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"#SBATCH --time 4:00:00")," pour demander 4 heures de temps."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"#SBATCH --time 2-12")," pour 2 jours et demi"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"#SBATCH --time 30")," pour 30 minutes"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"#SBATCH --time 30:00")," pour 30 minutes aussi")),(0,r.kt)("p",null,"La valeur par d\xe9faut et le maximum autoris\xe9 varient selon la configuration de chaque machine et d\xe9pendent souvent de la partition ou le job est soumis."),(0,r.kt)("p",null,"Attention: si le temps demand\xe9 d\xe9passe la limite autoris\xe9e, alors le job restera en attente ind\xe9finiment."),(0,r.kt)("h3",{id:"--partition--p"},(0,r.kt)("a",{parentName:"h3",href:"https://slurm.schedmd.com/sbatch.html#OPT_partition"},(0,r.kt)("inlineCode",{parentName:"a"},"--partition"),", ",(0,r.kt)("inlineCode",{parentName:"a"},"-p"))),(0,r.kt)("p",null,"La partition o\xf9 les ressources seront allou\xe9s. \xc9ventuellement une partition d\xe9faut a \xe9t\xe9 configur\xe9e sur votre machine."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"#SBATCH --partition compute")," demande une allocation sur la partition 'compute'."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"#SBATCH --partition shared,small")," demande une allocation sur la partition 'shared' ou 'small', l\xe0 o\xf9 le job pourra d\xe9marrer en premier.")),(0,r.kt)("h3",{id:"--nodes--n"},(0,r.kt)("a",{parentName:"h3",href:"https://slurm.schedmd.com/sbatch.html#OPT_nodes"},(0,r.kt)("inlineCode",{parentName:"a"},"--nodes"),", ",(0,r.kt)("inlineCode",{parentName:"a"},"-N"))),(0,r.kt)("p",null,"Le nombre de n\u0153uds demand\xe9s."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"#SBATCH --nodes 4")," (ou ",(0,r.kt)("inlineCode",{parentName:"p"},"#SBATCH -N 4"),") signifie qu'au moins 4 n\u0153uds seront allou\xe9s au job - mais d'autres option peuvent augmenter ce nombre.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"#SBATCH --nodes 2-4")," signifie qu'au moins 2 et au plus 4 n\u0153uds seront allou\xe9s au job."))),(0,r.kt)("h3",{id:"--ntasks--n"},(0,r.kt)("a",{parentName:"h3",href:"https://slurm.schedmd.com/sbatch.html#OPT_ntasks"},(0,r.kt)("inlineCode",{parentName:"a"},"--ntasks"),", ",(0,r.kt)("inlineCode",{parentName:"a"},"-n"))),(0,r.kt)("p",null,"Indique que le job comporte ",(0,r.kt)("inlineCode",{parentName:"p"},"--ntasks")," t\xe2ches, slurm d\xe9terminera alors les ressources \xe0 demander. La notion de ",(0,r.kt)("em",{parentName:"p"},"task")," dans slurm est assez proche d'un ",(0,r.kt)("em",{parentName:"p"},"process")," MPI."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"sur un cluster \xe9quip\xe9 de n\u0153uds 80-c\u0153urs l'option ",(0,r.kt)("inlineCode",{parentName:"li"},"#SBATCH -n 160")," demandera 2 n\u0153uds et 160 CPUs.")),(0,r.kt)("h3",{id:"--ntasks-per-node"},(0,r.kt)("a",{parentName:"h3",href:"https://slurm.schedmd.com/sbatch.html#OPT_ntasks-per-node"},(0,r.kt)("inlineCode",{parentName:"a"},"--ntasks-per-node"))),(0,r.kt)("p",null,"A utiliser avec l'option ",(0,r.kt)("inlineCode",{parentName:"p"},"--nodes"),"."),(0,r.kt)("h3",{id:"--cpus-per-task"},(0,r.kt)("a",{parentName:"h3",href:"https://slurm.schedmd.com/sbatch.html#OPT_cpus-per-task"},(0,r.kt)("inlineCode",{parentName:"a"},"--cpus-per-task"))),(0,r.kt)("p",null,"Souvent utilis\xe9 pour des jobs hybrides MPI/OpenMP. Par exemple"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"#SBATCH --nodes 2\n#SBATCH --ntasks-per-node 2\n#SBATCH --cpus-per-task 16\n")),(0,r.kt)("p",null,"demande 2 n\u0153uds et 32 c\u0153urs par n\u0153ud (pour 2 t\xe2ches par n\u0153ud utilisant 16 CPUs par t\xe2che)."),(0,r.kt)("h3",{id:"--mem"},(0,r.kt)("a",{parentName:"h3",href:"https://slurm.schedmd.com/sbatch.html#OPT_mem"},(0,r.kt)("inlineCode",{parentName:"a"},"--mem"))),(0,r.kt)("p",null,"La m\xe9moire ",(0,r.kt)("em",{parentName:"p"},"par n\u0153ud")," n\xe9cessaire. Exemples:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"SBATCH --mem=2000")," : 2000 Mo"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"SBATCH --mem=2000M")," : 2000 Mo"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"SBATCH --mem=2G")," : 2 Go"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"SBATCH --mem=1T")," : 1 To")),(0,r.kt)("h3",{id:"--reservation"},(0,r.kt)("a",{parentName:"h3",href:"https://slurm.schedmd.com/sbatch.html#OPT_reservation"},(0,r.kt)("inlineCode",{parentName:"a"},"--reservation"))),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"#SBATCH --reservation=toto")," alloue des ressources dans la reservation 'toto' si elle existe."),(0,r.kt)("p",null,"Typiquement les admins d'une machine peuvent cr\xe9er des reservations en avance pour des travaux pratiques."),(0,r.kt)("h3",{id:"opt-gpus"},(0,r.kt)("a",{parentName:"h3",href:"https://slurm.schedmd.com/sbatch.html#OPT_gpus"},(0,r.kt)("inlineCode",{parentName:"a"},"--gpus"),", ",(0,r.kt)("inlineCode",{parentName:"a"},"-G"))),(0,r.kt)("p",null,"L'option ",(0,r.kt)("inlineCode",{parentName:"p"},"--gpus=3")," demande l'allocation de 3 GPUs. Si diff\xe9rents types de GPUs sont disponible, il est possible de sp\xe9cifier le type: par exemple, ",(0,r.kt)("inlineCode",{parentName:"p"},"--gpus=ampere:5")," demande l'allocation de 5 GPUs de type ",(0,r.kt)("em",{parentName:"p"},"ampere"),"."),(0,r.kt)("p",null,"Voir aussi ",(0,r.kt)("a",{parentName:"p",href:"#opt-gpus-per-node"},(0,r.kt)("inlineCode",{parentName:"a"},"--gpus-per-node"))," et et ",(0,r.kt)("a",{parentName:"p",href:"#opt-gres"},(0,r.kt)("inlineCode",{parentName:"a"},"--gres")),"."),(0,r.kt)("h3",{id:"opt-gpus-per-node"},(0,r.kt)("a",{parentName:"h3",href:"https://slurm.schedmd.com/sbatch.html#OPT_gpus-per-node"},(0,r.kt)("inlineCode",{parentName:"a"},"--gpus-per-node"))),(0,r.kt)("p",null,"Comme ",(0,r.kt)("inlineCode",{parentName:"p"},"--gpus"),", mais ",(0,r.kt)("em",{parentName:"p"},"par n\u0153ud"),"."),(0,r.kt)("h3",{id:"opt-gres"},(0,r.kt)("a",{parentName:"h3",href:"https://slurm.schedmd.com/sbatch.html#OPT_gres"},(0,r.kt)("inlineCode",{parentName:"a"},"--gres"))),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"gres")," signifie consumable ",(0,r.kt)("em",{parentName:"p"},"generic resources"),". Les ",(0,r.kt)("em",{parentName:"p"},"gres")," disponibles varient selon la configuration des machines."),(0,r.kt)("p",null,"Le plus souvent ",(0,r.kt)("inlineCode",{parentName:"p"},"gres")," est utilis\xe9 pour r\xe9server des GPUs :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"#SBATCH --gres=gpu:2\n")),(0,r.kt)("p",null,"demande une r\xe9servation de 2 GPUs ",(0,r.kt)("em",{parentName:"p"},"par n\u0153ud"),"."),(0,r.kt)("p",null,"Comme dans ",(0,r.kt)("inlineCode",{parentName:"p"},"--gpus")," et ",(0,r.kt)("inlineCode",{parentName:"p"},"--gpus-per-node")," il est possible de sp\xe9cifier le type de GPU."),(0,r.kt)("p",null,"La commande ",(0,r.kt)("inlineCode",{parentName:"p"},"sbatch --gres=help")," permet de lister les ",(0,r.kt)("em",{parentName:"p"},"gres")," disponibles."),(0,r.kt)("h3",{id:"--job-name--j"},(0,r.kt)("a",{parentName:"h3",href:"https://slurm.schedmd.com/sbatch.html#OPT_job-name"},(0,r.kt)("inlineCode",{parentName:"a"},"--job-name"),", ",(0,r.kt)("inlineCode",{parentName:"a"},"-J"))),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"SBATCH --job-name=toto")," fera apparaitre le nom 'toto' dans les requ\xeates slurm. Par defaut, le nom du job sera celui du script de soumission."),(0,r.kt)("h3",{id:"--mail-user"},(0,r.kt)("a",{parentName:"h3",href:"https://slurm.schedmd.com/sbatch.html#OPT_mail-user"},(0,r.kt)("inlineCode",{parentName:"a"},"--mail-user"))),(0,r.kt)("p",null,"Activer des notifications par mail pour des \xe9v\xe9nements specifi\xe9 par ",(0,r.kt)("a",{parentName:"p",href:"https://slurm.schedmd.com/sbatch.html#OPT_mail-type"},(0,r.kt)("inlineCode",{parentName:"a"},"--mail-type")),"."),(0,r.kt)("h3",{id:"--output--o-"},(0,r.kt)("a",{parentName:"h3",href:"https://slurm.schedmd.com/sbatch.html#OPT_output"},(0,r.kt)("inlineCode",{parentName:"a"},"--output"),", ",(0,r.kt)("inlineCode",{parentName:"a"},"-o")," ")),(0,r.kt)("p",null,"et ",(0,r.kt)("a",{parentName:"p",href:"https://slurm.schedmd.com/sbatch.html#OPT_error"},(0,r.kt)("inlineCode",{parentName:"a"},"--error"),",",(0,r.kt)("inlineCode",{parentName:"a"},"-e"))," permettent de sp\xe9cifier le nom des fichiers sortie. Par d\xe9faut, les deux (output et error) sont redirig\xe9s vers un seul fichier ",(0,r.kt)("inlineCode",{parentName:"p"},"slurm-%j.out")," o\xf9 ",(0,r.kt)("inlineCode",{parentName:"p"},"%j")," est remplac\xe9 par le num\xe9ro de job."),(0,r.kt)("p",null,"Il est possible de cr\xe9er des fichiers de sortie par n\u0153ud ou par t\xe2che."),(0,r.kt)("p",null,"La ",(0,r.kt)("a",{parentName:"p",href:"https://slurm.schedmd.com/sbatch.html#SECTION_%3CB%3Efilename-pattern%3C/B%3E"},"documentation de slurm")," fournit plus de d\xe9tails sur la cr\xe9ation de fichiers de sortie."))}d.isMDXComponent=!0}}]);