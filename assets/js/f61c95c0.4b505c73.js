"use strict";(self.webpackChunkmesodocs=self.webpackChunkmesodocs||[]).push([[173],{4137:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>k});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var o=a.createContext({}),u=function(e){var t=a.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},d=function(e){var t=u(e.components);return a.createElement(o.Provider,{value:t},e.children)},m="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,o=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),m=u(n),c=r,k=m["".concat(o,".").concat(c)]||m[c]||p[c]||i;return n?a.createElement(k,l(l({ref:t},d),{},{components:n})):a.createElement(k,l({ref:t},d))}));function k(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,l=new Array(i);l[0]=c;var s={};for(var o in t)hasOwnProperty.call(t,o)&&(s[o]=t[o]);s.originalType=e,s[m]="string"==typeof e?e:r,l[1]=s;for(var u=2;u<i;u++)l[u]=n[u];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},7814:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>l,default:()=>p,frontMatter:()=>i,metadata:()=>s,toc:()=>u});var a=n(7462),r=(n(7294),n(4137));const i={title:"Lancer un calcul",sidebar_position:4},l="Lancer un job sur Bor\xe9ale",s={unversionedId:"machines/boreal/jobs",id:"machines/boreal/jobs",title:"Lancer un calcul",description:"Environnement de soumission (Slurm)",source:"@site/docs/machines/boreal/jobs.md",sourceDirName:"machines/boreal",slug:"/machines/boreal/jobs",permalink:"/documentation/machines/boreal/jobs",draft:!1,tags:[],version:"current",sidebarPosition:4,frontMatter:{title:"Lancer un calcul",sidebar_position:4},sidebar:"tutorialSidebar",previous:{title:"Le stockage",permalink:"/documentation/machines/boreal/stockage"},next:{title:"Environnements logiciels",permalink:"/documentation/machines/boreal/softenv"}},o={},u=[{value:"Environnement de soumission (Slurm)",id:"environnement-de-soumission-slurm",level:2},{value:"M\xe9moire",id:"m\xe9moire",level:3},{value:"Commandes",id:"commandes",level:3},{value:"Variables d&#39;environnement",id:"variables-denvironnement",level:3},{value:"Les partitions (classes de soumissions)",id:"les-partitions-classes-de-soumissions",level:3},{value:"Travaux d&#39;ex\xe9cution de calcul",id:"travaux-dex\xe9cution-de-calcul",level:4},{value:"Travaux de visualisation",id:"travaux-de-visualisation",level:4},{value:"Visualisation \xe0 distance",id:"visualisation-\xe0-distance",level:3},{value:"Gestion des signaux envoy\xe9s par Slurm",id:"gestion-des-signaux-envoy\xe9s-par-slurm",level:3}],d={toc:u},m="wrapper";function p(e){let{components:t,...n}=e;return(0,r.kt)(m,(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"lancer-un-job-sur-bor\xe9ale"},"Lancer un job sur Bor\xe9ale"),(0,r.kt)("h2",{id:"environnement-de-soumission-slurm"},"Environnement de soumission (Slurm)"),(0,r.kt)("p",null,"Le r\xe9pertoire ",(0,r.kt)("inlineCode",{parentName:"p"},"/soft/boreale/slurm/criann_scripts_templates")," contient les ",(0,r.kt)("strong",{parentName:"p"},"scripts de soumission")," g\xe9n\xe9riques pour code s\xe9quentiel ou OpenMP, MPI, MPI+OpenMP en mode natif (",(0,r.kt)("inlineCode",{parentName:"p"},"job*_VE.sl"),"), hybride (",(0,r.kt)("inlineCode",{parentName:"p"},"job_VE-VH.sl"),"), hybride au moyen de l'API VEDA (",(0,r.kt)("inlineCode",{parentName:"p"},"job_*VEDA*"),") ou purement CPU (",(0,r.kt)("inlineCode",{parentName:"p"},"job_MPI_OpenMP_VH.sl"),")."),(0,r.kt)("h3",{id:"m\xe9moire"},"M\xe9moire"),(0,r.kt)("p",null,"La directive ",(0,r.kt)("inlineCode",{parentName:"p"},"SBATCH --mem")," de Slurm contr\xf4le pour un travail :"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"la m\xe9moire r\xe9sidente (RSS) par VE : la limite demand\xe9e par ",(0,r.kt)("inlineCode",{parentName:"li"},"--mem")," s'applique \xe0 chaque VE du travail"),(0,r.kt)("li",{parentName:"ul"},"la m\xe9moire r\xe9sidente par VH : la limite demand\xe9e par ",(0,r.kt)("inlineCode",{parentName:"li"},"--mem")," s'applique au processus s\xe9quentiel, \xe0 la somme des threads ou \xe0 la somme des t\xe2ches MPI sur CPU du travail dans chacun de ses n\u0153uds de calcul (Vector Host).")),(0,r.kt)("h3",{id:"commandes"},"Commandes"),(0,r.kt)("p",null,"Ce tableau fournit les commandes utiles pour la soumission des travaux."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Action"),(0,r.kt)("th",{parentName:"tr",align:null},"Commande"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Caract\xe9ristiques des partitions (classes)"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"sinfo"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Soumettre un travail"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"sbatch script_soumission.sl"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},'Soumettre un travail en "hold" (attente)'),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"sbatch -H script_soumission.sl"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},'Lib\xe9rer un travail en "hold" (attente)'),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"scontrol release job_id"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Lister l'ensemble des travaux"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"squeue"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Lister ses propres travaux"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"squeue -u login"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Affichage des caract\xe9ristiques d'un travail"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"scontrol show job job_id"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Pr\xe9vision d'horaire de passage d'un travail en file d'attente"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"squeue --start --job job_id"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"V\xe9rification de la syntaxe et pr\xe9vision d'horaire de passage d'un travail sans le soumettre"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"sbatch --test-only script_soumission.sl"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Pr\xe9vision d'horaire de passage de ses propres travaux"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"squeue -u login --start"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Tuer un travail\tscancel"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"job_id"))))),(0,r.kt)("h3",{id:"variables-denvironnement"},"Variables d'environnement"),(0,r.kt)("p",null,"Les variables utilitaires suivantes (liste non exhaustive) peuvent \xeatre exploit\xe9es dans les commandes utilisateurs (Shell) d'un script de soumission."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Action"),(0,r.kt)("th",{parentName:"tr",align:null},"Commande"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"SLURM_JOB_ID")),(0,r.kt)("td",{parentName:"tr",align:null},"Identification du travail (exemple : 64549)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"SLURM_JOB_NAME")),(0,r.kt)("td",{parentName:"tr",align:null},"Nom du travail (sp\xe9cifi\xe9 par ",(0,r.kt)("inlineCode",{parentName:"td"},"#SBATCH -J"),")")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"SLURM_SUBMIT_DIR")),(0,r.kt)("td",{parentName:"tr",align:null},"Nom du r\xe9pertoire initial (dans lequel la commande ",(0,r.kt)("inlineCode",{parentName:"td"},"sbatch")," a \xe9t\xe9 lanc\xe9e)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"SLURM_NTASKS")),(0,r.kt)("td",{parentName:"tr",align:null},"Nombre de processus MPI du travail")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"LOCAL_WORK_DIR")),(0,r.kt)("td",{parentName:"tr",align:null},"Nom du r\xe9pertoire de scratch temporaire fond\xe9 sur le num\xe9ro du calcul : ",(0,r.kt)("inlineCode",{parentName:"td"},"/dlocal/run/$SLURM_JOB_ID"),". Cette arborescence est supprim\xe9e 45 jours apr\xe8s la fin du calcul.")))),(0,r.kt)("h3",{id:"les-partitions-classes-de-soumissions"},"Les partitions (classes de soumissions)"),(0,r.kt)("h4",{id:"travaux-dex\xe9cution-de-calcul"},"Travaux d'ex\xe9cution de calcul"),(0,r.kt)("p",null,"La partition est sp\xe9cifi\xe9e par le script de soumission avec la directive ",(0,r.kt)("inlineCode",{parentName:"p"},"#SBATCH --partition")," (ou dans la ligne de commande : ",(0,r.kt)("inlineCode",{parentName:"p"},"sbatch --partition compute script_soumission.sl"),")."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Partition"),(0,r.kt)("th",{parentName:"tr",align:null},"Dur\xe9e maximale"),(0,r.kt)("th",{parentName:"tr",align:null},"Noeuds disponibles"),(0,r.kt)("th",{parentName:"tr",align:null},"Limites par calcul"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"compute"),(0,r.kt)("td",{parentName:"tr",align:null},"100h"),(0,r.kt)("td",{parentName:"tr",align:null},"9 noeuds"),(0,r.kt)("td",{parentName:"tr",align:null},"9 n\u0153uds (288 c\u0153urs et 243000 Mo / n\u0153ud)")))),(0,r.kt)("h4",{id:"travaux-de-visualisation"},"Travaux de visualisation"),(0,r.kt)("p",null,"La commande ",(0,r.kt)("inlineCode",{parentName:"p"},"startvisu")," soumet un travail de partition ",(0,r.kt)("inlineCode",{parentName:"p"},"visu"),", demandant 64 Go de m\xe9moire, 4 c\u0153urs et 4 heures de limite de temps."),(0,r.kt)("p",null,"La demande en temps est extensible \xe0 une dur\xe9e sup\xe9rieure si besoin, par l'option --time (exemple pour 6 heures : ",(0,r.kt)("inlineCode",{parentName:"p"},"startvisu --time 6:00:00"),"). La limite de temps de la partition visu est de 8 heures."),(0,r.kt)("h3",{id:"visualisation-\xe0-distance"},"Visualisation \xe0 distance"),(0,r.kt)("p",null,"Une ",(0,r.kt)("a",{parentName:"p",href:"https://services.criann.fr/services/hpc/mesonet-project/guide/visu/"},"documentation sp\xe9cifique pour les travaux de visualisation")," est disponible."),(0,r.kt)("h3",{id:"gestion-des-signaux-envoy\xe9s-par-slurm"},"Gestion des signaux envoy\xe9s par Slurm"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://services.criann.fr/services/hpc/mesonet-project/guide/signals-sent-by-slurm/"},"Une documentation sp\xe9cifique pour attraper et traiter les signaux envoy\xe9s par Slurm")," est disponible."))}p.isMDXComponent=!0}}]);